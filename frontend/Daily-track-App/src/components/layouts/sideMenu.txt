version 1.2


import React, { useContext, useMemo, useCallback } from "react";
import { useNavigate } from "react-router-dom";
import { UserContext } from "../../context/userContext";
import { SIDE_MENU_DATA, SIDE_MENU_USER_DATA } from "../../utils/data";
import { LogOut, Settings } from 'lucide-react'; 

// --- Constants for Bottom Utility Menu ---
// Assuming SIDE_MENU_DATA holds the primary navigation items.
const UTILITY_MENU_DATA = [
    { label: "Setting", path: "/settings", icon: Settings },
    { label: "Log out", path: "logout", icon: LogOut },
];

// --- Sub-Component for Menu Item ---
const MenuItem = ({ item, activeMenu, onClick }) => {
  const isActive = activeMenu === item.label;

  return (
    <button
      key={item.label}
      aria-current={isActive ? 'page' : undefined}
      className={`
        w-full flex items-center gap-3 text-sm px-4 py-3 rounded-xl transition-colors duration-200 font-semibold
        hover:scale-[1.00] active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-blue-500/50
        // Dark theme styles
        ${isActive
          ? "bg-blue-600 text-white shadow-none"
          : "text-gray-300 hover:bg-gray-700/50 hover:text-white"
        }
      `}
      onClick={() => onClick(item.path)}
    >
      <div className="flex-shrink-0">
        <item.icon className={`w-5 h-5 transition-colors duration-200 ${isActive ? "text-white" : "text-gray-400"}`} />
      </div>
      <span className="tracking-wide">{item.label}</span>
    </button>
  );
};

// --- Main SideMenu Component (Fixed Dark Layout) ---
const SideMenu = ({ activeMenu }) => {
  const { user, clearUser } = useContext(UserContext);
  const navigate = useNavigate();

  // Removed isCollapsed state and logic for fixed UI style

  const mainSideMenuData = useMemo(() => {
    // Filter out items that are also in the utility menu if there's overlap, then filter by role
    const utilityLabels = UTILITY_MENU_DATA.map(item => item.label);
    const fullData = user?.role === "admin" ? SIDE_MENU_DATA : SIDE_MENU_USER_DATA;

    return fullData.filter(item => !utilityLabels.includes(item.label));
  }, [user]);

  const handleLogout = useCallback(() => {
    localStorage.removeItem("userToken");
    clearUser();
    navigate("/login");
  }, [clearUser, navigate]);

  const handleClick = useCallback((route) => {
    if (route === "logout") {
      handleLogout();
      return;
    }
    navigate(route);
  }, [handleLogout, navigate]); 
  
  // Unified Menu Body
  const menuBody = (
    <nav className={`
        // Dark Theme and Fixed Width (64 based on reference image)
        bg-gray-900 shadow-xl w-64 h-full flex flex-col transition-all duration-300 ease-in-out
        p-0
    `}>
      
      {/* 1. TOP SECTION: Logo / App Name Placeholder (To match the reference image) */}
      <header className="px-4 py-5 mb-2 flex items-center justify-start border-b border-gray-700/50">
          {/* Placeholder for small logo/icon */}
          <div className="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold text-sm">
              T
          </div>
          <h1 className="text-xl font-bold text-white ml-3">TaskHub</h1>
      </header>

      {/* 2. MAIN MENU ITEMS */}
      <ul className="flex flex-col gap-1 flex-1 overflow-y-auto px-2">
        {mainSideMenuData.map((item) => (
          <li key={item.label}>
            <MenuItem item={item} activeMenu={activeMenu} onClick={handleClick} />
          </li>
        ))}
      </ul>

      {/* 3. UTILITY MENU / LOGOUT (Stuck to the bottom) */}
      <ul className="mt-auto pt-4 pb-2 px-2 border-t border-gray-700/50">
        {UTILITY_MENU_DATA.map((item) => (
          <li key={item.label}>
            <MenuItem item={item} activeMenu={activeMenu} onClick={handleClick} />
          </li>
        ))}
      </ul>
    </nav>
  );

  return (
    <>
      {/* Removed DESKTOP TOGGLE BUTTON and its logic 
        as the reference image implies a fixed sidebar.
      */}

      {/* Main Container - Desktop View (Fixed Width) */}
      <div className={`
        // Ensuring visibility only on desktop, occupying the fixed 64 width
        hidden lg:block h-[calc(100vh)] transition-all duration-300 ease-in-out flex-shrink-0
        w-64
      `}>
        <div className="h-full sticky top-0">
          {menuBody}
        </div>
      </div>
    </>
  );
};

export default SideMenu;
